---
title: 数据库恢复
date: 2021-05-28 00:13:36
permalink: /courses/database/restore
categories:
  - Courses
  - 数据库原理
tags: 
  - SQL
  - DataBase
  - Backend
---

# 数据库恢复

## 日志文件


### 格式

数据库中每一个事务都会作为数据库的一条记录存储在日志文件中，每条日志记录会保存如下信息:

1. 各个事务的开始标记
2. 各个事务的结束标记
3. 各个事务的所有更新操作

若以数据库为单位进行存储的话，则会保存

1. 事务标识
2. 被更新的数据块

### 登记原则

登记的次序严格按照事务执行的次序进行，所有的事务都是**先写入日志文件，然后再写到数据库**中。

:::tip
事务执行完成的标识是日志文件中是否存在该事务的结束标记，也就是是否已经commit了。
:::

- 写日志文件操作: 把当前更新操作的详细信息记录到日志文件中
- 写数据库操作: 对数据的修改结果写到数据库中

## 检查点恢复

- 在建立检查点之前commit——不管
- 在发生故障之前commit——redo
- 在发生故障之前未commit——undo